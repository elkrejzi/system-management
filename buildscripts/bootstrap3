#!/bin/bash -e

pkg_remove() {
  find * -type f -o -type l | while read file ; do rm -fv "/$file" ; done
  find * -type d | sort -r | while read file ; do rmdir --ignore-fail-on-non-empty -v "/$file" ; done
}

export PKG_AUTO_INSTALL=1

$(dirname $0)/buildcogl
$(dirname $0)/buildgeocode-glib
$(dirname $0)/buildgmime
$(dirname $0)/buildlibgit2
$(dirname $0)/buildlibsigc++
$(dirname $0)/buildosinfo-db-tools
$(dirname $0)/buildpcre2
$(dirname $0)/buildraptor2
$(dirname $0)/buildrest
$(dirname $0)/buildtelepathy-glib
$(dirname $0)/buildwebkitgtk
$(dirname $0)/buildbabl
$(dirname $0)/buildcairomm
$(dirname $0)/buildcelt051
$(dirname $0)/buildclutter
$(dirname $0)/buildcolord-gtk
$(dirname $0)/buildexempi
$(dirname $0)/buildgexiv2
$(dirname $0)/buildgjs
$(dirname $0)/buildglibmm
$(dirname $0)/buildgnome-autoar
$(dirname $0)/buildgnome-desktop
$(dirname $0)/buildgnome-menus
$(dirname $0)/buildgnome-online-accounts
$(dirname $0)/buildgnome-video-effects
$(dirname $0)/buildgsound
$(dirname $0)/buildgspell
$(dirname $0)/buildgtk-vnc
$(dirname $0)/buildgtksourceview
$(dirname $0)/buildlibcacard
$(dirname $0)/buildlibcue
$(dirname $0)/buildlibgee
$(dirname $0)/buildlibgepub
$(dirname $0)/buildlibgit2-glib
$(dirname $0)/buildlibgrss
$(dirname $0)/buildlibgsf
$(dirname $0)/buildlibgtop
$(dirname $0)/buildlibgweather
$(dirname $0)/buildlibgxps
$(dirname $0)/buildlibkpathsea
$(dirname $0)/buildlibmediaart
$(dirname $0)/buildliboauth
$(dirname $0)/buildlibosinfo
$(dirname $0)/buildlibpaper
$(dirname $0)/buildlibpeas
$(dirname $0)/buildlibpwquality
$(dirname $0)/buildlibspectre
$(dirname $0)/buildlibwnck
$(dirname $0)/buildlibxklavier
$(dirname $0)/buildnetwork-manager-applet
$(dirname $0)/buildosinfo-db
$(dirname $0)/buildspice-protocol
$(dirname $0)/buildt1lib
$(dirname $0)/buildtelepathy-logger
$(dirname $0)/buildtelepathy-mission-control
$(dirname $0)/buildtotem-pl-parser
$(dirname $0)/builduhttpmock
$(dirname $0)/buildvte
$(dirname $0)/buildyelp-xsl
$(dirname $0)/buildzeitgeist
$(dirname $0)/buildzenity
$(dirname $0)/buildzziplib
$(dirname $0)/buildaccountsservice
$(dirname $0)/buildatkmm
$(dirname $0)/buildclutter-gst
$(dirname $0)/buildclutter-gtk
$(dirname $0)/buildgegl
$(dirname $0)/buildgfbgraph
$(dirname $0)/buildgnome-backgrounds
$(dirname $0)/buildgnome-bluetooth
$(dirname $0)/buildgnome-settings-daemon
$(dirname $0)/buildgom
$(dirname $0)/buildgrilo
$(dirname $0)/buildlibdmapsharing
$(dirname $0)/buildlibgdata
$(dirname $0)/buildlibzapojit
$(dirname $0)/buildmutter
$(dirname $0)/buildnautilus
$(dirname $0)/buildpangomm
$(dirname $0)/buildspice
$(dirname $0)/buildspice-gtk
$(dirname $0)/buildcaribou
$(dirname $0)/buildcheese
$(dirname $0)/buildevince
$(dirname $0)/buildevolution-data-server
$(dirname $0)/buildgnome-keyring
$(dirname $0)/buildgtkmm2
$(dirname $0)/buildgtkmm3
$(dirname $0)/buildgucharmap
$(dirname $0)/buildlibchamplain
$(dirname $0)/buildlibmypaint
$(dirname $0)/buildtracker
$(dirname $0)/buildyelp
$(dirname $0)/buildfolks
$(dirname $0)/buildaisleriot
$(dirname $0)/buildcups-pk-helper
$(dirname $0)/builddconf-editor
$(dirname $0)/buildeog
$(dirname $0)/buildepiphany
$(dirname $0)/buildfile-roller
$(dirname $0)/buildgdm
$(dirname $0)/buildgedit
$(dirname $0)/buildgedit-code-assistance
$(dirname $0)/buildgedit-latex
$(dirname $0)/buildgedit-plugins
$(dirname $0)/buildgnome-calculator
$(dirname $0)/buildgnome-calendar
$(dirname $0)/buildgnome-clocks
$(dirname $0)/buildgnome-color-manager
$(dirname $0)/buildgnome-contacts
$(dirname $0)/buildgnome-control-center
$(dirname $0)/buildgnome-disk-utility
$(dirname $0)/buildgnome-documents
$(dirname $0)/buildgnome-logs
$(dirname $0)/buildgnome-maps
$(dirname $0)/buildgnome-nettool
$(dirname $0)/buildgnome-online-miners
$(dirname $0)/buildgnome-photos
$(dirname $0)/buildgnome-power-manager
$(dirname $0)/buildgnome-session
$(dirname $0)/buildgnome-todo
$(dirname $0)/buildgnome-tweak-tool
$(dirname $0)/buildgnome-system-monitor
$(dirname $0)/buildgnome-weather
$(dirname $0)/buildgrilo-plugins
$(dirname $0)/buildgvfs
$(dirname $0)/buildpolari
$(dirname $0)/buildseahorse
$(dirname $0)/buildvinagre
$(dirname $0)/buildvino
$(dirname $0)/buildxdg-user-dirs
$(dirname $0)/buildxdg-user-dirs-gtk
$(dirname $0)/buildgnome-shell
$(dirname $0)/buildgnome-shell-extensions
$(dirname $0)/buildgnome-terminal
$(dirname $0)/buildgnome-user-docs
$(dirname $0)/buildgupnp-components
$(dirname $0)/builddleyna
$(dirname $0)/buildmailnag
$(dirname $0)/buildmailnag-gnome-shell
$(dirname $0)/buildperl-modules 2
$(dirname $0)/buildpython-m2crypto
$(dirname $0)/buildpython-typing
$(dirname $0)/buildbluefish
$(dirname $0)/buildgimp
$(dirname $0)/buildgparted
$(dirname $0)/buildhexchat
#$(dirname $0)/buildtigervnc
$(dirname $0)/buildtransmission
$(dirname $0)/buildwireshark
$(dirname $0)/buildwireless-regdb
$(dirname $0)/buildcrda
$(dirname $0)/buildctags
$(dirname $0)/builddmidecode
$(dirname $0)/builddosfstools
$(dirname $0)/builded
$(dirname $0)/buildethtool
$(dirname $0)/buildgdb
$(dirname $0)/buildiputils
$(dirname $0)/buildiw
$(dirname $0)/buildkpartx
$(dirname $0)/buildlsof
$(dirname $0)/buildmtools
$(dirname $0)/buildnetkit-telnet
$(dirname $0)/buildrfkill
$(dirname $0)/buildrubber
$(dirname $0)/buildstrace
$(dirname $0)/buildsudo
$(dirname $0)/buildtraceroute
$(dirname $0)/buildunrar
$(dirname $0)/buildvalgrind
$(dirname $0)/buildvim
$(dirname $0)/buildwhois
$(dirname $0)/buildacpica
$(dirname $0)/buildlibiscsi
$(dirname $0)/buildusbredir
$(dirname $0)/buildvde2
$(dirname $0)/buildvirglrenderer
$(dirname $0)/buildseabios
$(dirname $0)/buildqemu
$(dirname $0)/buildtexlive
$(dirname $0)/builddblatex
$(dirname $0)/buildGConf
$(dirname $0)/buildlibjpeg-turbo6
$(dirname $0)/buildlibpng12
$(dirname $0)/buildgoogle-chrome
$(dirname $0)/buildjdk
$(dirname $0)/buildlibreoffice-upstream
$(dirname $0)/buildyoutube-dl

find /binary -name "INSTALL" -exec grep -rl "exit 0" {} \; | while read f ; do head --lines -2 ${f} > ${f}.new ; mv ${f}.new ${f} ; chmod 755 ${f} ; done

find /binary -type d -name "*-[0-9]*" ! -path "*/etc/*" ! -path "*/opt/*" ! -path "*/usr/*" | while read dir
do
  P=$(basename ${dir})
  D=$(dirname ${dir})

  pushd ${D}
    tar cf ${P}.tar ${P}
    rm -rf ${P}
  popd
done

find /binary -name "*.tar" -exec xz -T4 {} \;
