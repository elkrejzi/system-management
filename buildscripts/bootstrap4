#!/bin/bash -e

pkg_remove() {
  find * -type f -o -type l | while read file ; do rm -fv "/$file" ; done
  find * -type d | sort -r | while read file ; do rmdir --ignore-fail-on-non-empty -v "/$file" ; done
}

export PKG_AUTO_INSTALL=1

$(dirname $0)/buildxorg-server
$(dirname $0)/buildxf86-input-evdev
$(dirname $0)/buildxf86-input-libinput
$(dirname $0)/buildxf86-input-synaptics
$(dirname $0)/buildxf86-input-wacom
$(dirname $0)/buildxf86-video-ati
$(dirname $0)/buildxf86-video-intel
$(dirname $0)/buildmedia-player-info
$(dirname $0)/buildmobile-broadband-provider-info
$(dirname $0)/buildlibplist
$(dirname $0)/buildlibusbmuxd
$(dirname $0)/buildlibimobiledevice
$(dirname $0)/buildcln
$(dirname $0)/buildfontforge
$(dirname $0)/buildlibatasmart
$(dirname $0)/buildlibdmtx
$(dirname $0)/buildlibzip
$(dirname $0)/buildlm_sensors
$(dirname $0)/buildlmdb
$(dirname $0)/buildmozjs24
$(dirname $0)/buildparted
$(dirname $0)/buildqrencode
$(dirname $0)/buildxapian-core
$(dirname $0)/buildxerces-c
$(dirname $0)/buildalsa-plugins
$(dirname $0)/buildalsa-utils
$(dirname $0)/builddoxygen
$(dirname $0)/buildebook-tools
$(dirname $0)/buildgrantlee
$(dirname $0)/buildlibdbusmenu-qt
$(dirname $0)/buildlibqalculate
$(dirname $0)/buildphonon
$(dirname $0)/buildphonon-backend-gstreamer
$(dirname $0)/buildphonon-backend-vlc
$(dirname $0)/buildpolkit-qt-1
$(dirname $0)/buildqca
$(dirname $0)/buildudisks
$(dirname $0)/buildupower
$(dirname $0)/buildweston
$(dirname $0)/buildxsd
$(dirname $0)/buildcogl
$(dirname $0)/buildgeocode-glib
$(dirname $0)/buildgmime
$(dirname $0)/buildlibsigc++
$(dirname $0)/buildrest
$(dirname $0)/buildtelepathy-glib
$(dirname $0)/buildcairomm
$(dirname $0)/buildclutter
$(dirname $0)/buildcolord-gtk
$(dirname $0)/buildexempi
$(dirname $0)/buildgjs
$(dirname $0)/buildglibmm
$(dirname $0)/buildgnome-desktop
$(dirname $0)/buildgnome-menus
$(dirname $0)/buildgnome-online-accounts
$(dirname $0)/buildgnome-video-effects
$(dirname $0)/buildgtk-vnc
$(dirname $0)/buildgtksourceview
$(dirname $0)/buildlibgee
$(dirname $0)/buildlibgtop
$(dirname $0)/buildlibgweather
$(dirname $0)/buildlibgxps
$(dirname $0)/buildlibkpathsea
$(dirname $0)/buildliboauth
$(dirname $0)/buildlibpaper
$(dirname $0)/buildlibpeas
$(dirname $0)/buildlibpwquality
$(dirname $0)/buildlibspectre
$(dirname $0)/buildlibunique
$(dirname $0)/buildlibwnck
$(dirname $0)/buildlibxklavier
$(dirname $0)/buildlibwacom
$(dirname $0)/buildmate-desktop
$(dirname $0)/buildnetwork-manager-applet
$(dirname $0)/buildprelink
$(dirname $0)/buildt1lib
$(dirname $0)/buildtelepathy-logger
$(dirname $0)/buildtelepathy-mission-control
$(dirname $0)/buildtotem-pl-parser
$(dirname $0)/builduhttpmock
$(dirname $0)/buildvte
$(dirname $0)/buildyelp-xsl
$(dirname $0)/buildzenity
$(dirname $0)/buildzziplib
$(dirname $0)/buildaccountsservice
$(dirname $0)/buildatkmm
$(dirname $0)/buildcaja
$(dirname $0)/buildclutter-gst
$(dirname $0)/buildclutter-gtk
$(dirname $0)/buildgnome-backgrounds
$(dirname $0)/buildgnome-bluetooth
$(dirname $0)/buildgnome-settings-daemon
$(dirname $0)/buildgrilo
$(dirname $0)/buildlibgdata
$(dirname $0)/buildmutter
$(dirname $0)/buildnautilus
$(dirname $0)/buildpangomm
$(dirname $0)/buildcaribou
$(dirname $0)/buildcheese
$(dirname $0)/buildevince
$(dirname $0)/buildevolution-data-server
$(dirname $0)/buildgnome-keyring
$(dirname $0)/buildgtkmm2
$(dirname $0)/buildgtkmm3
$(dirname $0)/buildgucharmap
$(dirname $0)/buildyelp
$(dirname $0)/buildaisleriot
$(dirname $0)/buildcups-pk-helper
$(dirname $0)/buildeog
$(dirname $0)/buildepiphany
$(dirname $0)/buildfile-roller
$(dirname $0)/buildgdm
$(dirname $0)/buildgedit
$(dirname $0)/buildgnome-calculator
$(dirname $0)/buildgnome-color-manager
$(dirname $0)/buildgnome-control-center
$(dirname $0)/buildgnome-disk-utility
$(dirname $0)/buildgnome-logs
$(dirname $0)/buildgnome-nettool
$(dirname $0)/buildgnome-power-manager
$(dirname $0)/buildgnome-session
$(dirname $0)/buildgnome-tweak-tool
$(dirname $0)/buildgnome-system-monitor
$(dirname $0)/buildgvfs
$(dirname $0)/buildseahorse
$(dirname $0)/buildvinagre
$(dirname $0)/buildvino
$(dirname $0)/buildxdg-user-dirs
$(dirname $0)/buildxdg-user-dirs-gtk
$(dirname $0)/buildgnome-shell
$(dirname $0)/buildgnome-shell-extensions
$(dirname $0)/buildgnome-terminal
$(dirname $0)/buildgnome-user-docs
$(dirname $0)/buildlightdm
$(dirname $0)/buildlightdm-gtk-greeter
$(dirname $0)/buildasciidoc
$(dirname $0)/buildbabl
$(dirname $0)/buildchmlib
$(dirname $0)/buildenscript
$(dirname $0)/buildexpect
$(dirname $0)/buildgsl
$(dirname $0)/buildlibc-client
$(dirname $0)/buildlibmcrypt
$(dirname $0)/buildlibopenraw
$(dirname $0)/buildlibtxc_dxtn
$(dirname $0)/buildlibva-intel-driver
$(dirname $0)/buildlibvdpau-va-gl
$(dirname $0)/buildmhash
$(dirname $0)/buildnss-mdns
$(dirname $0)/buildqpdf
$(dirname $0)/buildtidy
$(dirname $0)/buildbind
$(dirname $0)/buildbroadcom-wl
$(dirname $0)/buildflashplayer
$(dirname $0)/buildgegl
$(dirname $0)/buildpostfix
$(dirname $0)/buildrtkit
$(dirname $0)/buildsmartmontools
$(dirname $0)/buildperl-modules 2
$(dirname $0)/buildpython-m2crypto
$(dirname $0)/buildpython-notify
$(dirname $0)/buildpython-pillow
$(dirname $0)/buildpython-pyyaml
$(dirname $0)/buildpython-reportlab
$(dirname $0)/buildpython-unidecode
$(dirname $0)/buildbluefish
$(dirname $0)/buildcgit
$(dirname $0)/buildcups-filters
$(dirname $0)/buildgimp
$(dirname $0)/buildgparted
$(dirname $0)/buildinkscape
$(dirname $0)/buildphp
$(dirname $0)/buildsqlitebrowser
$(dirname $0)/buildtransmission
$(dirname $0)/buildwireshark
$(dirname $0)/buildxscreensaver
$(dirname $0)/buildwireless-regdb
$(dirname $0)/buildcrda
$(dirname $0)/buildfoomatic-db-engine
$(dirname $0)/buildfoomatic-db
$(dirname $0)/buildhplip
$(dirname $0)/buildlibnfsidmap
$(dirname $0)/buildlibtirpc
$(dirname $0)/buildnfs-utils
$(dirname $0)/buildrpcbind
$(dirname $0)/buildcdrdao
$(dirname $0)/buildcdrtools
$(dirname $0)/builddvd+rw-tools
$(dirname $0)/buildtranscode
$(dirname $0)/buildsound-theme-freedesktop
$(dirname $0)/buildbtrfs-progs
$(dirname $0)/buildcabextract
$(dirname $0)/buildcpio
$(dirname $0)/builddejagnu
$(dirname $0)/builddmidecode
$(dirname $0)/builddosfstools
$(dirname $0)/builded
$(dirname $0)/buildethtool
$(dirname $0)/buildgdb
$(dirname $0)/buildhdparm
$(dirname $0)/buildiputils
$(dirname $0)/buildiw
$(dirname $0)/buildkpartx
$(dirname $0)/buildlsof
$(dirname $0)/buildmtools
$(dirname $0)/buildncftp
$(dirname $0)/buildpowertop
$(dirname $0)/buildrfkill
$(dirname $0)/buildsocat
$(dirname $0)/buildstrace
$(dirname $0)/buildsudo
$(dirname $0)/buildthermal_daemon
$(dirname $0)/buildtraceroute
$(dirname $0)/buildunrar
$(dirname $0)/buildvalgrind
$(dirname $0)/buildwhois
$(dirname $0)/buildxfsprogs
$(dirname $0)/buildjdk

find /binary -name "INSTALL" -exec grep -rl "exit 0" {} \; | while read f ; do head --lines -2 ${f} > ${f}.new ; mv ${f}.new ${f} ; chmod 755 ${f} ; done

find /binary -type d -name "*-[0-9]*" ! -path "*/etc/*" ! -path "*/usr/*" | while read dir
do
  P=$(basename ${dir})
  D=$(dirname ${dir})

  pushd ${D}
    tar cf ${P}.tar ${P}
    rm -rf ${P}
  popd
done

find /binary -name "*.tar" -exec xz -T4 {} \;
